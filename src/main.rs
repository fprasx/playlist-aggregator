use anyhow::Result;
use spotify::{add_tracks_to_playlist, authorize, create_playlist, get_all_tracks, greet};

#[tokio::main]
async fn main() -> Result<()> {
    env_logger::init();

    greet();

    let spotify = authorize().await?;

    let (new_id, new_name) = create_playlist(
        &spotify,
        Some(&format!(
            "Generated by Rust on {}",
            chrono::offset::Local::now()
        )),
    )
    .await?;

    let tracks = get_all_tracks(&spotify).await;

    add_tracks_to_playlist(&spotify, &new_id, tracks, new_name).await?;

    Ok(())
}
